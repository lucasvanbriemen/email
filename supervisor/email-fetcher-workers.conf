[program:email-fetcher-workers]
process_name=%(program_name)s_%(process_num)02d
command=php /var/www/vhosts/lucasvanbriemen.nl/email.lucasvanbriemen.nl/artisan queue:work database --queue=email_fetching --sleep=3 --tries=3 --max-time=3600
autostart=true
autorestart=true
user=www-data
numprocs=5
redirect_stderr=true
stdout_logfile=/var/www/vhosts/lucasvanbriemen.nl/email.lucasvanbriemen.nl/storage/logs/worker.log
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=10
stopasgroup=true
priority=998

; Supervisor configuration for the email fetching queue workers
;
; These workers process email fetching jobs dispatched by the dispatcher.
; Run multiple workers in parallel to handle concurrent email fetching for different profiles.
;
; IMPORTANT: Update the paths below to match your server:
; - command=php /var/www/email_client/artisan queue:work ...
;   Replace /var/www/email_client with your actual application path
; - user=www-data
;   Change to your web server user (www-data for Apache, nginx for Nginx, etc.)
; - stdout_logfile=/var/www/email_client/storage/logs/worker.log
;   Update path to match your application path
; - numprocs=5
;   Adjust based on your profile count (see guidelines below)
;
; Worker count guidelines:
; - 1-5 profiles: 1-2 workers
; - 5-10 profiles: 2-3 workers
; - 10-20 profiles: 3-5 workers
; - 20+ profiles: 5-10 workers
;
; Installation steps:
; 1. Copy this file to /etc/supervisor/conf.d/ or your supervisor configs directory
; 2. Update the paths above
; 3. Adjust numprocs if needed
; 4. Run: sudo supervisorctl reread && sudo supervisorctl update
; 5. Start: sudo supervisorctl start email-fetcher-workers:*
;
; Monitoring:
; - Check status: sudo supervisorctl status email-fetcher-workers:*
; - View logs: tail -f /var/www/email_client/storage/logs/worker.log
; - Restart all: sudo supervisorctl restart email-fetcher-workers:*
; - Restart specific worker: sudo supervisorctl restart email-fetcher-workers_00
; - Stop all: sudo supervisorctl stop email-fetcher-workers:*
;
; Configuration explanation:
; - sleep=3: Wait 3 seconds between checking for new jobs (adjust based on needs)
; - tries=3: Retry failed jobs 3 times (matches config/email_fetching.php)
; - max-time=3600: Restart worker after 1 hour to prevent memory leaks
; - stopasgroup=true: Stop all child processes when stopping the group
